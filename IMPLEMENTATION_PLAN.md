# XS言語 実装計画

## 概要
AI向け高速静的解析言語「XS」の実装計画。S式ベースの静的型付き言語で、HM型推論を実装する。

## 言語設計の方針
- **AIのための設計**: 高速な静的解析結果を返すことを最優先
- **S式構文**: パーサー実装の効率化と解析の高速化
- **静的型付き**: 明示的な型アノテーションをサポート
- **HM型推論**: 型の自動推論による記述効率の向上

## 実装ステップ

### 1. プロジェクト初期設定
- [ ] Rust workspaceの作成
- [ ] 各crateの初期構造作成
  - parser
  - checker
  - interpreter
  - cli
- [ ] 共通型定義用のcore crateの作成

### 2. Parser実装（TDD）
- [ ] AST定義
  - 基本的なS式表現
  - 型アノテーション構文
  - リテラル、識別子、リスト
- [ ] パーサー基本実装
  - トークナイザー
  - S式パーサー
  - エラーハンドリング
- [ ] テスト
  - 単純なS式のパース
  - 型アノテーション付きS式
  - エラーケース

### 3. Type Checker実装（TDD）
- [ ] 型システムの定義
  - 基本型（Int, Bool, String, List, Function）
  - 型変数
  - 型スキーム
- [ ] HM型推論エンジン
  - 制約生成
  - 単一化（Unification）
  - 一般化と具体化
- [ ] スコープ管理
  - 変数スコープ
  - 型スコープ
- [ ] テスト（重点的に）
  - 基本的な型推論
  - let多相
  - 関数の型推論
  - エラーケース

### 4. Interpreter実装（TDD）
- [ ] 値の表現
  - ランタイム値の定義
  - 環境（変数束縛）
- [ ] 評価器
  - S式の評価
  - 関数適用
  - 特殊形式（let, if, lambda）
- [ ] テスト
  - 型推論を通過したプログラムの実行
  - 各種データ型の操作
  - 再帰関数

### 5. CLI実装
- [ ] コマンドライン引数パーサー
- [ ] 各サブコマンドの実装
  - `xsc parse <file>`: AST表示
  - `xsc check <file>`: 型チェック結果表示
  - `xsc run <file>`: プログラム実行
- [ ] エラー表示の整形

### 6. 統合テストとサンプル
- [ ] エンドツーエンドテスト
- [ ] サンプルプログラム作成
  - 基本的な計算
  - リスト操作
  - 高階関数
  - 型推論の活用例

## 言語仕様（概要）

### 基本構文
```lisp
; 変数定義
(let x 42)
(let f (lambda (x) (+ x 1)))

; 型アノテーション
(let x : Int 42)
(let f : (-> Int Int) (lambda (x) (+ x 1)))

; 関数適用
(f 10)

; 条件分岐
(if (< x 10) "small" "large")

; リスト
(list 1 2 3)
(cons 1 (list 2 3))
```

### 型システム
- 基本型: Int, Bool, String
- 複合型: List a, (-> a b)
- 型変数: a, b, c...
- Let多相

## 技術的な実装方針
- **パーサー**: nom または手書きパーサー
- **型推論**: Algorithm W
- **エラー報告**: 詳細な位置情報付き
- **最適化**: AI用途のため、静的解析の高速化を重視

## スケジュール目安
1. 初期設定: 30分
2. Parser: 2時間
3. Type Checker: 3時間
4. Interpreter: 2時間
5. CLI: 1時間
6. 統合テスト: 1時間

計: 約9.5時間での完成を目指す