# XS Language Server

XS言語のLanguage Server Protocol (LSP) 実装です。

## 機能

### 実装済み
- **診断機能** - パースエラーと型エラーのリアルタイム表示
- **ホバー情報** - 式の型情報を表示
- **補完機能** - キーワードとビルトイン関数の補完
- **ソースマップ** - ソース位置とASTノードのマッピング

### 今後の実装予定
- **定義へのジャンプ** - 変数や関数の定義位置へのナビゲーション
- **参照の検索** - 変数や関数の使用箇所の一覧表示
- **リネーム** - 変数や関数名の一括変更
- **コードフォーマット** - XSコードの自動整形

## ビルドとインストール

```bash
# ビルド
cargo build --release -p xs-lsp

# インストール
cargo install --path xs-lsp
```

## 使用方法

### VSCode拡張機能として使用（推奨）

VSCode拡張機能は現在開発中です。

### 手動でLSPサーバーを起動

```bash
xs-lsp
```

LSPサーバーは標準入出力を使用してクライアントと通信します。

## 開発

### デバッグログの有効化

```bash
RUST_LOG=xs_lsp=debug,tower_lsp=debug xs-lsp
```

### テスト

```bash
cargo test -p xs-lsp
```

## アーキテクチャ

### モジュール構成

- **backend.rs** - LSPサーバーのメイン実装
- **source_map.rs** - ソースコード位置とASTノードのマッピング
- **text_document.rs** - テキストドキュメントの管理
- **handlers/** - LSPリクエストハンドラ
  - hover.rs - ホバー情報の提供
  - completion.rs - コード補完
  - goto_definition.rs - 定義へのジャンプ
  - references.rs - 参照の検索

### ソースマップ

ソースマップは以下の機能を提供します：

1. **位置変換** - バイトオフセットから行/列位置への変換
2. **範囲計算** - ASTノードのソースコード範囲の計算
3. **位置検索** - 指定位置にあるASTノードの検索

## 今後の計画

1. VSCode拡張機能の作成
2. より高度な型情報の表示
3. Effect Systemのサポート
4. コンテンツアドレス型コードベースとの統合
5. リファクタリング支援機能