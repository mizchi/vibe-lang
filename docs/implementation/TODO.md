# XS Language TODO

## 次のアクションアイテム

### 1. WebAssembly Component Model対応（高優先度）
- ✅ WIT（WebAssembly Interface Types）の生成
- ✅ コンポーネントとしてのビルドと配布
- ✅ XSコードからWITへの自動変換
- ✅ wasm-encoder, wit-parser, wit-component統合
- ✅ component_builder実装
- 📋 rec関数のエクスポート対応

### 2. CIへのsimilarity-rs組み込み（中優先度）
- GitHub Actionsでの重複コード検出
- PR時の自動チェック

### 3. 残りのパーサーメソッドのリファクタリング（中優先度）
- parse_match, parse_patternなど
- parser_helpers.rsの更なる活用

## 実装予定機能

### 優先度：高

1. **リスト操作の完全実装**
   - [ ] car, cdr, null?の実装
   - [ ] 高階関数（map, filter, fold）の最適化

2. **モジュールシステムの完全実装**
   - [ ] モジュールの型チェック
   - [ ] インポート/エクスポートの解決
   - [ ] 修飾名（Module.name）の型推論
   - [ ] モジュール間の依存関係解決

3. **WebAssembly バックエンドの完成**
   - [ ] リスト/配列のGC型での実装
   - [ ] クロージャのGC構造体実装
   - [ ] 適切な型インデックス管理

### 優先度：中

4. **Perceus完全実装**
   - [ ] 参照カウント
   - [ ] drop/dup命令の自動挿入
   - [ ] reuse最適化

5. **標準ライブラリの拡充**
   - [ ] List操作（reverse, append, take, drop）
   - [ ] Option/Result型の完全実装
   - [ ] 基本的なI/O（read, write）

6. **エンドツーエンドコンパイラパイプライン**
   - [ ] XSファイル → WASMバイナリの直接生成
   - [ ] スタンドアロンWASMモジュール生成
   - [ ] WASI対応（システムコール）
   - [ ] 最適化パス（定数畳み込み、デッドコード除去）

### 優先度：低

7. **開発ツール**
   - [ ] LSP実装の完成
   - [ ] デバッガ
   - [ ] プロファイラ

8. **最適化**
   - [ ] インライン展開
   - [ ] 定数畳み込み
   - [ ] 末尾呼び出し最適化

## リファクタリング計画

### 完了済み ✅
- [x] テストヘルパーの共通化（58%削減）
- [x] パーサーの重複コード削減（22%削減）
- [x] ShellStateのリファクタリング（34%削減）

### 計画中
- [ ] 残りのパーサーメソッドのリファクタリング
- [ ] エラーハンドリングの統一
- [ ] CIへのsimilarity-rs組み込み

## AI向け言語としての特徴強化

1. **構造化データ出力**
   - [ ] AST/型情報のJSON出力の改善
   - [ ] インクリメンタル解析結果のストリーミング
   - [ ] エラー情報の更なる構造化

2. **AIフレンドリーな構文**
   - [ ] 明示的な型アノテーション推奨のドキュメント化
   - [ ] 構文規則の一貫性確保
   - [ ] 最小限の構文糖衣の維持