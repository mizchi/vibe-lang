# XS Language TODO

## 実装済み機能

### 基本機能

- [x] S 式パーサー
- [x] Hindley-Milner 型推論
- [x] インタープリター
- [x] 再帰関数（`rec`構文）
- [x] CLI（parse, check, run, test コマンド）

### 基本型

- [x] プリミティブ型（Int, Float, Bool, String, List）
- [x] 算術演算子（+, -, \*, /）
- [x] 比較演算子（<, >, <=, >=, =）
- [x] リスト操作（list, cons）
- [x] 高階関数とクロージャ
- [x] if 式
- [x] let/let-rec 式
- [x] ラムダ式

### 高度な機能（基礎実装）

- [x] Salsa フレームワーク統合（インクリメンタルコンパイル）
- [x] Perceus IR 層（基礎実装）
- [x] WebAssembly バックエンド（基礎実装）
- [x] パターンマッチング
- [x] 代数的データ型（ADT）
- [x] モジュールシステム（パース実装済み）
- [x] Wasmtime 統合（実行テスト）
- [x] テストランナーフレームワーク

## 実装予定機能

## ユーザーリクエスト: 未分類

- [x] lambda -> fn に (完了)
- [ ] WebAssembly Component Model に対応して、ビルドしたコンポーネントを配布できるようようにする
- [ ] tutorial を書く

### 優先度：高

1. **ビルトイン関数の実装**
   - [x] 算術演算（+, -, \*, /, %）の IR 生成と WASM 生成 (完了)
   - [x] 比較演算（<, >, <=, >=, =）の IR 生成と WASM 生成 (完了)
   - [x] print関数の実装 (完了)
   - [ ] リスト操作（car, cdr, null?）の実装
   - [ ] 文字列操作の基本実装
2. **モジュールシステムの完全実装**
   - モジュールの型チェック
   - インポート/エクスポートの解決
   - 修飾名（Module.name）の型推論
   - モジュール間の依存関係解決
3. **WebAssembly バックエンドの完成**
   - 文字列リテラルの適切な実装
   - リスト/配列の GC 型での実装
   - クロージャの GC 構造体実装
   - 適切な型インデックス管理

### 優先度：中

4. **Perceus 完全実装**

   - 参照カウント
   - drop/dup 命令の自動挿入
   - reuse 最適化

5. **標準ライブラリ**
   - String 操作（concat, substring, length, etc）
   - List 操作（map, filter, fold, reverse, append）
   - Option/Result 型とその操作
   - 基本的な I/O（print, read）
   - 数学関数（abs, min, max, mod）
6. **エンドツーエンドコンパイラパイプライン**
   - XS ファイル → WASM バイナリの直接生成
   - スタンドアロン WASM モジュール生成
   - WASI 対応（システムコール）
   - 最適化パス（定数畳み込み、デッドコード除去）

### 優先度：低

7. **エラーメッセージ改善**

   - より詳細なエラー位置情報
   - エラーリカバリ
   - 提案機能

8. **開発ツール**

   - REPL
   - デバッガ
   - LSP 実装

9. **最適化**
   - インライン展開
   - 定数畳み込み
   - 末尾呼び出し最適化

## リファクタリング候補

### エラー処理

- [ ] `TypeScheme`と`Type`の統合
- [ ] エラーメッセージの一元管理

### インタープリター

- [ ] `Value::Closure`と`Value::RecClosure`の統合検討
- [ ] より効率的な`Environment`実装

### パーサー

- [ ] 重複コードの削減
- [ ] より一貫性のある`Span`使用

### テスト

- [ ] テストユーティリティの共通化
- [ ] プロパティベーステスト（quickcheck 等）の導入
- [ ] ベンチマークスイートの追加

## 次のステップ（推奨実装順序）

1. **ビルトイン関数の実装**

   - まず算術演算を IR/WASM で動くようにする
   - これにより実際のプログラムが書けるようになる

2. **基本的な標準ライブラリ**

   - [x] print 関数でデバッグ可能にする (完了)
   - [ ] 基本的なリスト操作関数（map, filter, fold）
   - [ ] 文字列操作関数（length, substring, split）

3. **モジュールシステムの完成**

   - 型チェッカーと IR 生成器での対応
   - 標準ライブラリをモジュールとして提供

4. **WebAssembly バックエンドの完成**

   - GC 型の適切な利用
   - WAASI サポートで実用的なプログラムを実行

5. **Perceus 最適化**
   - 参照カウントと reuse 最適化でメモリ効率向上

## AI 向け言語としての特徴強化

1. **静的解析 API**

   - 型情報の高速クエリ
   - 依存グラフの生成
   - シンボル解決の高速化

2. **構造化データ出力**

   - AST/型情報の JSON 出力
   - インクリメンタル解析結果のストリーミング
   - エラー情報の構造化

3. **AI フレンドリーな構文**
   - 明示的な型アノテーション推奨
   - 単純で一貫性のある構文規則
   - 最小限の構文糖衣
